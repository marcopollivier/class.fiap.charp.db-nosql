# Docker Compose para ambiente de desenvolvimento local
# Este arquivo é apenas para referência - não substitui a AWS real

version: '3.8'

services:
  # LocalStack - Simula serviços AWS localmente (opcional)
  localstack:
    image: localstack/localstack:latest
    container_name: fiap-localstack
    ports:
      - "4566:4566"  # Endpoint principal do LocalStack
      - "4510-4559:4510-4559"  # Serviços externos
    environment:
      - SERVICES=s3,dynamodb,iam
      - DEBUG=1
      - DATA_DIR=/tmp/localstack/data
      - LAMBDA_EXECUTOR=docker
      - DOCKER_HOST=unix:///var/run/docker.sock
    volumes:
      - "/tmp/localstack:/tmp/localstack"
      - "/var/run/docker.sock:/var/run/docker.sock"
    networks:
      - fiap-network

  # Terraform container (para quem não quer instalar localmente)
  terraform:
    image: hashicorp/terraform:latest
    container_name: fiap-terraform
    working_dir: /workspace
    volumes:
      - .:/workspace
      - ~/.aws:/root/.aws:ro  # Credenciais AWS (read-only)
    environment:
      - AWS_PROFILE=default
    networks:
      - fiap-network
    command: ["sleep", "infinity"]  # Manter container rodando

  # AWS CLI container (para quem não quer instalar localmente)
  awscli:
    image: amazon/aws-cli:latest
    container_name: fiap-awscli
    working_dir: /workspace
    volumes:
      - .:/workspace
      - ~/.aws:/root/.aws:ro  # Credenciais AWS (read-only)
    networks:
      - fiap-network
    command: ["sleep", "infinity"]  # Manter container rodando

networks:
  fiap-network:
    driver: bridge

# Comandos úteis:
# docker-compose up -d localstack    # Subir LocalStack para testes locais
# docker-compose exec terraform sh   # Executar comandos Terraform no container
# docker-compose exec awscli sh      # Executar comandos AWS CLI no container
# docker-compose down                # Parar todos os serviços